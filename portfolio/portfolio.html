<script>
    // PDF.js setup
    const pdfjsLib = window['pdfjs-dist/build/pdf'];
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://unpkg.com/pdfjs-dist@3.4.120/build/pdf.worker.min.js';

    // Fetch the manually created JSON file with PDF details
    fetch('/pdfFiles.json')
        .then(response => response.json())
        .then(pdfFiles => {
            const pdfContainer = document.getElementById('pdf-container');

            // Group PDFs by category
            const categories = {};
            pdfFiles.forEach(file => {
                if (!categories[file.category]) {
                    categories[file.category] = [];
                }
                categories[file.category].push(file);
            });

            // Function to render PDF thumbnail or fallback for links
            function generateThumbnail(pdfFile, categoryDiv) {
                const isPdf = pdfFile.path.endsWith(".pdf");

                if (isPdf) {
                    // Generate a PDF thumbnail
                    const loadingTask = pdfjsLib.getDocument(pdfFile.path);
                    loadingTask.promise.then(function(pdf) {
                        // Get the first page
                        pdf.getPage(1).then(function(page) {
                            const scale = 0.3; // Set thumbnail size
                            const viewport = page.getViewport({ scale: scale });

                            // Create a canvas element to render the PDF page
                            const canvas = document.createElement('canvas');
                            const context = canvas.getContext('2d');
                            canvas.width = viewport.width;
                            canvas.height = viewport.height;

                            // Render the page into the canvas context
                            const renderContext = {
                                canvasContext: context,
                                viewport: viewport
                            };
                            page.render(renderContext).promise.then(function() {
                                // Create the thumbnail div
                                const div = document.createElement('div');
                                div.classList.add('thumbnail');
                                const link = document.createElement('a');
                                link.href = pdfFile.path;
                                link.target = '_blank';
                                link.innerText = pdfFile.name;
                                div.appendChild(canvas);
                                div.appendChild(link);
                                categoryDiv.appendChild(div);
                            });
                        });
                    }, function(reason) {
                        console.error('Error loading PDF: ' + reason);
                    });
                } else {
                    // Handle external or non-PDF links (use a default thumbnail or icon)
                    const div = document.createElement('div');
                    div.classList.add('thumbnail');
                    
                    // Create an image or default thumbnail for non-PDFs
                    const defaultThumbnail = document.createElement('img');
                    defaultThumbnail.src = 'https://via.placeholder.com/100x150?text=Link'; // Placeholder or your custom image
                    defaultThumbnail.alt = 'Link Thumbnail';
                    defaultThumbnail.style.width = '100px';
                    defaultThumbnail.style.height = '150px';

                    const link = document.createElement('a');
                    link.href = pdfFile.path;
                    link.target = '_blank';
                    link.innerText = pdfFile.name;

                    div.appendChild(defaultThumbnail); // Append the image as thumbnail
                    div.appendChild(link);             // Append the link below the image
                    categoryDiv.appendChild(div);      // Add this to the category div
                }
            }

            // Render PDFs and external links by category
            for (const [category, files] of Object.entries(categories)) {
                // Create a section for each category
                const categoryDiv = document.createElement('div');
                categoryDiv.classList.add('category');
                const categoryTitle = document.createElement('h3');
                categoryTitle.innerText = category;
                categoryDiv.appendChild(categoryTitle);

                // Generate thumbnails or links for each file in the category
                files.forEach(pdfFile => {
                    generateThumbnail(pdfFile, categoryDiv);
                });

                // Append the category section to the main container
                pdfContainer.appendChild(categoryDiv);
            }
        });
</script>
